<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal Child Benefit Boost | NEF Ã— PolicyEngine</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,700;1,9..40,400&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            /* NEF Mission Colors */
            --nef-crimson: #c32e30;
            --nef-crimson-dark: #a02527;
            --nef-crimson-light: #e85a5c;
            --nef-teal: #368f7a;
            --nef-teal-dark: #2a7362;
            --nef-cobalt: #2e70a3;
            --nef-cobalt-dark: #245a83;

            /* Neutrals */
            --ink: #1a1a1a;
            --ink-light: #4a4a4a;
            --paper: #fafaf8;
            --paper-warm: #f5f3ef;
            --cream: #fffef9;

            /* Type */
            --font-display: 'Instrument Serif', Georgia, serif;
            --font-body: 'DM Sans', -apple-system, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 18px;
            scroll-behavior: smooth;
        }

        body {
            font-family: var(--font-body);
            background: var(--cream);
            color: var(--ink);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Hero Section */
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
            background: linear-gradient(135deg, var(--nef-crimson) 0%, var(--nef-crimson-dark) 100%);
            padding: 2rem;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url("data:image/svg+xml,%3Csvg viewBox='0 0 400 400' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
            opacity: 0.03;
            pointer-events: none;
        }

        .hero-content {
            position: relative;
            max-width: 1200px;
            margin: 0 auto;
            z-index: 1;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 1.25rem;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 100px;
            margin-bottom: 2rem;
            color: white;
            font-size: 0.85rem;
            font-weight: 500;
            letter-spacing: 0.02em;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .hero-badge::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #4ade80;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.2); }
        }

        .hero h1 {
            font-family: var(--font-display);
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 400;
            color: white;
            line-height: 1.05;
            margin-bottom: 1.5rem;
            letter-spacing: -0.02em;
        }

        .hero h1 em {
            font-style: italic;
            color: rgba(255, 255, 255, 0.85);
        }

        .hero-subtitle {
            font-size: clamp(1.1rem, 2vw, 1.4rem);
            color: rgba(255, 255, 255, 0.9);
            max-width: 650px;
            margin-bottom: 3rem;
            line-height: 1.5;
        }

        .hero-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            max-width: 900px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 16px;
            padding: 1.5rem;
            transition: transform 0.3s ease, background 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            background: rgba(255, 255, 255, 0.15);
        }

        .stat-value {
            font-family: var(--font-display);
            font-size: 2.5rem;
            color: white;
            font-weight: 400;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.75);
            font-weight: 500;
        }

        /* Scroll indicator */
        .scroll-indicator {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }

        .scroll-indicator svg {
            width: 24px;
            height: 24px;
        }

        /* Main Content */
        .main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 6rem 2rem;
        }

        .section-header {
            text-align: center;
            margin-bottom: 4rem;
        }

        .section-header h2 {
            font-family: var(--font-display);
            font-size: clamp(2rem, 4vw, 3rem);
            color: var(--ink);
            margin-bottom: 1rem;
            font-weight: 400;
        }

        .section-header p {
            font-size: 1.1rem;
            color: var(--ink-light);
            max-width: 600px;
            margin: 0 auto;
        }

        /* Chart Container */
        .chart-section {
            margin-bottom: 5rem;
        }

        .chart-container {
            background: white;
            border-radius: 24px;
            padding: 2rem;
            box-shadow: 0 4px 40px rgba(0, 0, 0, 0.06);
            border: 1px solid rgba(0, 0, 0, 0.04);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
        }

        .chart-title {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--ink);
        }

        .chart-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .chart-btn {
            padding: 0.5rem 1rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background: white;
            border-radius: 100px;
            font-family: var(--font-body);
            font-size: 0.85rem;
            color: var(--ink-light);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .chart-btn:hover {
            border-color: var(--nef-crimson);
            color: var(--nef-crimson);
        }

        .chart-btn.active {
            background: var(--nef-crimson);
            border-color: var(--nef-crimson);
            color: white;
        }

        .chart-wrapper {
            height: 400px;
            position: relative;
        }

        /* Impact Cards Grid */
        .impact-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-bottom: 5rem;
        }

        .impact-card {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.04);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .impact-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--nef-crimson);
            transform: scaleY(0);
            transform-origin: bottom;
            transition: transform 0.3s ease;
        }

        .impact-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 50px rgba(0, 0, 0, 0.08);
        }

        .impact-card:hover::before {
            transform: scaleY(1);
        }

        .impact-card-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .impact-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .impact-icon.children-1 { background: rgba(195, 46, 48, 0.1); }
        .impact-icon.children-2 { background: rgba(54, 143, 122, 0.1); }
        .impact-icon.children-3 { background: rgba(46, 112, 163, 0.1); }

        .impact-card-title {
            font-weight: 600;
            color: var(--ink);
            font-size: 1rem;
        }

        .impact-card-subtitle {
            font-size: 0.85rem;
            color: var(--ink-light);
        }

        .impact-value {
            font-family: var(--font-display);
            font-size: 2.5rem;
            color: var(--nef-crimson);
            margin-bottom: 0.25rem;
        }

        .impact-description {
            font-size: 0.9rem;
            color: var(--ink-light);
            line-height: 1.5;
        }

        /* Policy Explainer */
        .policy-section {
            background: var(--paper-warm);
            border-radius: 32px;
            padding: 4rem;
            margin-bottom: 5rem;
        }

        .policy-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
        }

        @media (max-width: 768px) {
            .policy-grid {
                grid-template-columns: 1fr;
            }
        }

        .policy-column h3 {
            font-family: var(--font-display);
            font-size: 1.75rem;
            color: var(--ink);
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .policy-column h3::before {
            content: '';
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: block;
        }

        .policy-column.current h3::before {
            background: linear-gradient(135deg, #ddd 0%, #bbb 100%);
        }

        .policy-column.reform h3::before {
            background: linear-gradient(135deg, var(--nef-crimson) 0%, var(--nef-crimson-dark) 100%);
        }

        .policy-item {
            display: flex;
            justify-content: space-between;
            padding: 1rem 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }

        .policy-item:last-child {
            border-bottom: none;
        }

        .policy-item-label {
            color: var(--ink-light);
        }

        .policy-item-value {
            font-weight: 600;
            color: var(--ink);
        }

        .policy-column.reform .policy-item-value {
            color: var(--nef-crimson);
        }

        /* Footer */
        .footer {
            background: var(--ink);
            color: white;
            padding: 4rem 2rem;
            text-align: center;
        }

        .footer-content {
            max-width: 600px;
            margin: 0 auto;
        }

        .footer-logos {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-logo {
            font-family: var(--font-display);
            font-size: 1.5rem;
            opacity: 0.9;
        }

        .footer-divider {
            width: 1px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
        }

        .footer p {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .footer a {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: underline;
            text-underline-offset: 2px;
        }

        /* Data source badge */
        .data-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(195, 46, 48, 0.08);
            border-radius: 100px;
            font-size: 0.8rem;
            color: var(--nef-crimson);
            margin-bottom: 1rem;
        }

        .data-badge svg {
            width: 16px;
            height: 16px;
        }

        /* Code Block */
        .code-section {
            margin-bottom: 5rem;
        }

        .code-container {
            background: #1e1e2e;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.15);
        }

        .code-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            background: #181825;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .code-header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .code-dots {
            display: flex;
            gap: 6px;
        }

        .code-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .code-dot.red { background: #f38ba8; }
        .code-dot.yellow { background: #f9e2af; }
        .code-dot.green { background: #a6e3a1; }

        .code-filename {
            color: #cdd6f4;
            font-size: 0.85rem;
            font-family: 'SF Mono', 'Fira Code', monospace;
        }

        .code-badge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.35rem 0.75rem;
            background: rgba(166, 227, 161, 0.1);
            border: 1px solid rgba(166, 227, 161, 0.2);
            border-radius: 100px;
            color: #a6e3a1;
            font-size: 0.75rem;
            font-family: var(--font-body);
        }

        .code-content {
            padding: 1.5rem;
            overflow-x: auto;
        }

        .code-content pre {
            margin: 0;
            font-family: 'SF Mono', 'Fira Code', 'Consolas', monospace;
            font-size: 0.9rem;
            line-height: 1.7;
            color: #cdd6f4;
        }

        .code-content .comment { color: #6c7086; }
        .code-content .key { color: #89b4fa; }
        .code-content .string { color: #a6e3a1; }
        .code-content .number { color: #fab387; }
        .code-content .bracket { color: #f5c2e7; }

        .code-link {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1.5rem;
            padding: 0.75rem 1.25rem;
            background: var(--nef-crimson);
            color: white;
            text-decoration: none;
            border-radius: 100px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .code-link:hover {
            background: var(--nef-crimson-dark);
            transform: translateY(-2px);
        }

        .code-link svg {
            width: 18px;
            height: 18px;
        }

        /* Animations */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-in {
            animation: fadeInUp 0.8s ease forwards;
        }

        .delay-1 { animation-delay: 0.1s; }
        .delay-2 { animation-delay: 0.2s; }
        .delay-3 { animation-delay: 0.3s; }
        .delay-4 { animation-delay: 0.4s; }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <div class="hero-badge">
                <span>Live policyengine-uk Python package via Modal</span>
            </div>
            <h1>Universal<br>Child Benefit <em>Boost</em></h1>
            <p class="hero-subtitle">
                Double Child Benefit rates and abolish the High Income Child Benefit Charge â€”
                delivering up to Â£6,297 more per year for families across the UK.
            </p>
            <div class="hero-stats">
                <div class="stat-card">
                    <div class="stat-value">Â£2,793</div>
                    <div class="stat-label">Average annual gain per family</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">Â£6,297</div>
                    <div class="stat-label">Maximum annual gain</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">10%+</div>
                    <div class="stat-label">Income boost for low-income families</div>
                </div>
            </div>
        </div>
        <div class="scroll-indicator">
            <span>Scroll to explore</span>
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
            </svg>
        </div>
    </section>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Impact by Income Chart -->
        <section class="chart-section">
            <div class="section-header">
                <div class="data-badge">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                    </svg>
                    Real data from PolicyEngine UK
                </div>
                <h2>Impact by household income</h2>
                <p>Annual gain in Â£ for families with children at different income levels</p>
            </div>

            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">Annual household income gain</h3>
                    <div class="chart-controls">
                        <button class="chart-btn active" data-children="1">1 child</button>
                        <button class="chart-btn" data-children="2">2 children</button>
                        <button class="chart-btn" data-children="3">3 children</button>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="incomeChart"></canvas>
                </div>
            </div>
        </section>

        <!-- Household Impact Cards -->
        <section class="impact-grid">
            <div class="impact-card">
                <div class="impact-card-header">
                    <div class="impact-icon children-1">ðŸ‘¶</div>
                    <div>
                        <div class="impact-card-title">Single parent, 1 child</div>
                        <div class="impact-card-subtitle">Â£35,000 annual income</div>
                    </div>
                </div>
                <div class="impact-value">+Â£1,378</div>
                <p class="impact-description">
                    A 4.6% boost to household income. Child Benefit rises from Â£1,355 to Â£2,709 per year.
                </p>
            </div>

            <div class="impact-card">
                <div class="impact-card-header">
                    <div class="impact-icon children-2">ðŸ‘§ðŸ‘¦</div>
                    <div>
                        <div class="impact-card-title">Single parent, 2 children</div>
                        <div class="impact-card-subtitle">Â£35,000 annual income</div>
                    </div>
                </div>
                <div class="impact-value">+Â£2,290</div>
                <p class="impact-description">
                    A 7.2% boost to household income. Child Benefit nearly doubles, lifting family finances significantly.
                </p>
            </div>

            <div class="impact-card">
                <div class="impact-card-header">
                    <div class="impact-icon children-3">ðŸ‘§ðŸ‘¦ðŸ‘¶</div>
                    <div>
                        <div class="impact-card-title">Single parent, 3 children</div>
                        <div class="impact-card-subtitle">Â£35,000 annual income</div>
                    </div>
                </div>
                <div class="impact-value">+Â£3,203</div>
                <p class="impact-description">
                    An 8.6% boost to household income. Larger families see the biggest absolute gains.
                </p>
            </div>

            <div class="impact-card">
                <div class="impact-card-header">
                    <div class="impact-icon children-2" style="background: rgba(46, 112, 163, 0.1);">ðŸŽ“</div>
                    <div>
                        <div class="impact-card-title">High earner, 2 children</div>
                        <div class="impact-card-subtitle">Â£80,000 annual income</div>
                    </div>
                </div>
                <div class="impact-value">+Â£4,503</div>
                <p class="impact-description">
                    HICBC abolition means full Child Benefit restored. This family was previously losing benefits to the charge.
                </p>
            </div>
        </section>

        <!-- Policy Comparison -->
        <section class="policy-section">
            <div class="section-header" style="margin-bottom: 3rem;">
                <h2>The policy reform</h2>
                <p>What changes and what stays the same</p>
            </div>

            <div class="policy-grid">
                <div class="policy-column current">
                    <h3>Current policy</h3>
                    <div class="policy-item">
                        <span class="policy-item-label">Eldest child rate</span>
                        <span class="policy-item-value">Â£26.05/week</span>
                    </div>
                    <div class="policy-item">
                        <span class="policy-item-label">Additional children</span>
                        <span class="policy-item-value">Â£17.25/week</span>
                    </div>
                    <div class="policy-item">
                        <span class="policy-item-label">HICBC starts at</span>
                        <span class="policy-item-value">Â£60,000</span>
                    </div>
                    <div class="policy-item">
                        <span class="policy-item-label">HICBC ends at</span>
                        <span class="policy-item-value">Â£80,000</span>
                    </div>
                </div>

                <div class="policy-column reform">
                    <h3>Reform proposal</h3>
                    <div class="policy-item">
                        <span class="policy-item-label">Eldest child rate</span>
                        <span class="policy-item-value">Â£52.10/week</span>
                    </div>
                    <div class="policy-item">
                        <span class="policy-item-label">Additional children</span>
                        <span class="policy-item-value">Â£34.50/week</span>
                    </div>
                    <div class="policy-item">
                        <span class="policy-item-label">HICBC</span>
                        <span class="policy-item-value">Abolished</span>
                    </div>
                    <div class="policy-item">
                        <span class="policy-item-label">Universal access</span>
                        <span class="policy-item-value">All families</span>
                    </div>
                </div>
            </div>
        </section>

        <!-- Code Section -->
        <section class="code-section">
            <div class="section-header">
                <h2>The code</h2>
                <p>PolicyEngine reform specification used to generate this analysis</p>
            </div>

            <div class="code-container">
                <div class="code-header">
                    <div class="code-header-left">
                        <div class="code-dots">
                            <span class="code-dot red"></span>
                            <span class="code-dot yellow"></span>
                            <span class="code-dot green"></span>
                        </div>
                        <span class="code-filename">reform.py</span>
                    </div>
                    <div class="code-badge">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                            <polyline points="22 4 12 14.01 9 11.01"/>
                        </svg>
                        Verified on PolicyEngine UK
                    </div>
                </div>
                <div class="code-content">
<pre><span class="comment"># Universal Child Benefit Boost</span>
<span class="comment"># pip install policyengine-uk</span>

<span class="key">from</span> policyengine_uk <span class="key">import</span> Microsimulation

<span class="comment"># Define the reform</span>
<span class="key">reform</span> = <span class="bracket">{</span>
    <span class="comment"># Double eldest child rate: Â£26.05 â†’ Â£52.10/week</span>
    <span class="string">"gov.hmrc.child_benefit.amount.eldest"</span>: <span class="bracket">{</span>
        <span class="string">"year:2024:10"</span>: <span class="number">52.10</span>
    <span class="bracket">}</span>,
    <span class="comment"># Double additional children: Â£17.25 â†’ Â£34.50/week</span>
    <span class="string">"gov.hmrc.child_benefit.amount.additional"</span>: <span class="bracket">{</span>
        <span class="string">"year:2024:10"</span>: <span class="number">34.50</span>
    <span class="bracket">}</span>,
    <span class="comment"># Abolish HICBC</span>
    <span class="string">"gov.hmrc.income_tax.charges.CB_HITC.phase_out_start"</span>: <span class="bracket">{</span>
        <span class="string">"year:2024:10"</span>: <span class="number">10_000_000</span>
    <span class="bracket">}</span>
<span class="bracket">}</span>

<span class="comment"># Run microsimulation</span>
baseline = Microsimulation()
reformed = Microsimulation(<span class="key">reform</span>=reform)

<span class="comment"># Calculate impacts</span>
year = <span class="number">2024</span>
baseline_income = baseline.calculate(<span class="string">"household_net_income"</span>, year)
reformed_income = reformed.calculate(<span class="string">"household_net_income"</span>, year)
gain = reformed_income - baseline_income

<span class="key">print</span>(<span class="string">f"Average gain: Â£</span><span class="bracket">{</span>gain.mean():<span class="number">.0f</span><span class="bracket">}</span><span class="string">/year"</span>)</pre>
                </div>
            </div>

            <div style="text-align: center; margin-top: 2rem;">
                <a href="https://policyengine.org/uk/policy?reform=1&focus=gov.hmrc.child_benefit.amount.eldest&gov.hmrc.child_benefit.amount.eldest=52.10&gov.hmrc.child_benefit.amount.additional=34.50&gov.hmrc.income_tax.charges.CB_HITC.phase_out_start=10000000" target="_blank" class="code-link">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                    </svg>
                    Open in PolicyEngine UK
                </a>
            </div>
        </section>

        <!-- Percentage Impact Chart -->
        <section class="chart-section">
            <div class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">Proportional impact by income</h3>
                    <div class="chart-controls">
                        <button class="chart-btn pct-btn active" data-children="1">1 child</button>
                        <button class="chart-btn pct-btn" data-children="2">2 children</button>
                        <button class="chart-btn pct-btn" data-children="3">3 children</button>
                    </div>
                </div>
                <div class="chart-wrapper">
                    <canvas id="pctChart"></canvas>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-logos">
                <span class="footer-logo">NEF</span>
                <div class="footer-divider"></div>
                <span class="footer-logo">PolicyEngine</span>
            </div>
            <p>
                Analysis powered by <a href="https://policyengine.org/uk" target="_blank">PolicyEngine UK</a>
                using the enhanced Family Resources Survey 2023-24 microsimulation dataset.
            </p>
            <p style="margin-top: 1rem;">
                January 2026 Â· Created for NEF meeting demonstration
            </p>
        </div>
    </footer>

    <script>
        // Modal API endpoint
        const API_URL = 'https://maxghenis--policyengine-uk-demo-calculate.modal.run';

        // Initial static data (will be updated by API)
        const data = {
            incomes: [15000, 20000, 25000, 30000, 35000, 40000, 50000, 60000, 70000, 80000, 100000],
            changes: {
                1: [1378, 1378, 1378, 1378, 1378, 1378, 1378, 1378, 2043, 2709, 2709],
                2: [2290, 2290, 2290, 2290, 2290, 2291, 2291, 2290, 3397, 4503, 4503],
                3: [3203, 3203, 3203, 3203, 3203, 3203, 3203, 3203, 4750, 6297, 6297]
            },
            pctChanges: {
                1: [6.6, 6.2, 5.7, 5.2, 4.6, 4.1, 3.4, 3.0, 4.0, 4.8, 4.0],
                2: [9.1, 8.6, 8.1, 7.6, 7.2, 6.7, 5.5, 4.8, 6.5, 7.9, 6.6],
                3: [10.4, 9.9, 9.4, 9.0, 8.6, 8.0, 6.8, 6.0, 8.3, 10.2, 9.2]
            },
            loading: { 1: false, 2: false, 3: false },
            loaded: { 1: false, 2: false, 3: false }
        };

        // Fetch live data from Modal API
        async function fetchData(numChildren) {
            if (data.loading[numChildren] || data.loaded[numChildren]) return;
            data.loading[numChildren] = true;

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ num_children: numChildren })
                });
                const result = await response.json();

                data.changes[numChildren] = result.results.map(r => r.change);
                data.pctChanges[numChildren] = result.results.map(r => r.pct_change);
                data.loaded[numChildren] = true;

                // Update charts if this is the active selection
                updateChartsIfActive(numChildren);
            } catch (e) {
                console.error('API error:', e);
            } finally {
                data.loading[numChildren] = false;
            }
        }

        function updateChartsIfActive(numChildren) {
            const activeBtn = document.querySelector('.chart-btn:not(.pct-btn).active');
            if (activeBtn && parseInt(activeBtn.dataset.children) === numChildren) {
                incomeChart.data.datasets[0].data = data.changes[numChildren];
                incomeChart.update();
            }
            const activePctBtn = document.querySelector('.pct-btn.active');
            if (activePctBtn && parseInt(activePctBtn.dataset.children) === numChildren) {
                pctChart.data.datasets[0].data = data.pctChanges[numChildren];
                pctChart.update();
            }
        }

        // Prefetch data for all child counts
        setTimeout(() => { fetchData(1); fetchData(2); fetchData(3); }, 1000);

        const colors = {
            1: '#c32e30',
            2: '#368f7a',
            3: '#2e70a3'
        };

        const labels = data.incomes.map(v => 'Â£' + (v/1000) + 'k');

        // Income Chart
        const incomeCtx = document.getElementById('incomeChart').getContext('2d');
        const incomeChart = new Chart(incomeCtx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Annual gain (Â£)',
                    data: data.changes[1],
                    backgroundColor: colors[1],
                    borderRadius: 6,
                    borderSkipped: false
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `+Â£${ctx.raw.toLocaleString()}/year`
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(0,0,0,0.05)' },
                        ticks: {
                            callback: (v) => 'Â£' + v.toLocaleString()
                        }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        });

        // Percentage Chart
        const pctCtx = document.getElementById('pctChart').getContext('2d');
        const pctChart = new Chart(pctCtx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Income boost (%)',
                    data: data.pctChanges[1],
                    borderColor: colors[1],
                    backgroundColor: colors[1] + '20',
                    fill: true,
                    tension: 0.4,
                    pointRadius: 6,
                    pointHoverRadius: 8
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: (ctx) => `+${ctx.raw.toFixed(1)}%`
                        }
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(0,0,0,0.05)' },
                        ticks: {
                            callback: (v) => v + '%'
                        }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        });

        // Button handlers for income chart
        document.querySelectorAll('.chart-btn:not(.pct-btn)').forEach(btn => {
            btn.addEventListener('click', () => {
                const children = parseInt(btn.dataset.children);
                document.querySelectorAll('.chart-btn:not(.pct-btn)').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                // Fetch live data if not already loaded
                fetchData(children);

                incomeChart.data.datasets[0].data = data.changes[children];
                incomeChart.data.datasets[0].backgroundColor = colors[children];
                incomeChart.update();
            });
        });

        // Button handlers for pct chart
        document.querySelectorAll('.pct-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const children = parseInt(btn.dataset.children);
                document.querySelectorAll('.pct-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                // Fetch live data if not already loaded
                fetchData(children);

                pctChart.data.datasets[0].data = data.pctChanges[children];
                pctChart.data.datasets[0].borderColor = colors[children];
                pctChart.data.datasets[0].backgroundColor = colors[children] + '20';
                pctChart.update();
            });
        });
    </script>
</body>
</html>
